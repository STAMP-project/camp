# Proactive CAMP sample

In the context of the project STAMP, ActiveEon is a use case to explore several configuration notably for using different databases. This readme explain show how to run camp for proactive worflows & schedulling.

## Building camp last version


To build camp go to project root and use:

```bash
docker build . -t camp
```

To run camp within the created image use.

```bash
docker run -it camp bash
```

Work whithin the docker container has some drawbacks. The changes on the current
drive are not seem or either presistent. Alternatively, you can also use a
mounting point so camp container access an outside folder.


```bash
docker run -t -v $PWD:/campworkingdir camp camp -h
```

Now you can proceed to use camp. For instance for this example change current
directory to be `samples/stamp/activeeon` and then run:

```bash
docker run -t -v $PWD:/campworkingdir camp camp generate -d /campworkingdir
```

CAMP then generates new Dockerfiles, properly chained together according to the
configurations generated by camp generate. To do so, you can apply the following
 command:

```bash
docker run -t -v $PWD:/campworkingdir camp camp realize -d /campworkingdir
```

You can clean exited container and unlinked images using:

```bash
docker system prune
```

## Running configurations

Now that the configurations are generated, you need to do some modifications
to make it work:



* You need to provide your host machine address to configure the
 proactive server on docker. e.g., on mac or linux you can use `ifconfig`.

* To get snapshot version of proactive from jenkins, you need to provide the
username and api-token first. Visit the jenkins site
`http://<yourserver>/user/<username>/configure` and then generate the token.

* Now edit the scripts `get-last-proactive-do-not-commit.sh` and replace
USERNAME and TOKEN by your credentials.



* Finally to start the proactive server with go to the config folder generated
by camp, `cd out/config_1` and run `docker-compose up`
to start both containers (proactive + database.)

## Run system-tests

* Now it is time to run system-tests over generated configs.

* The scheduling-system-tests project is a private repo on bitbucket. Access to the repo has to be requested ([please contact us](mailto:fabien.viale@activeeon.com))

-Clone the project
```bash
git clone https://bitbucket.org/activeeon/scheduling-system-tests/src/master/
```
-Run tests
```bash
./gradlew clean -Plocal test
```
## Todo

- Configure gradle.build to skip the failing tests due to docker use in some workflows.

## References

* Proactive docker container to target system tests;

  - The last build proactive artifact [here](http://jenkins.activeeon.com/view/NightlyRelease/job/nightly-release/lastSuccessfulBuild/artifact/build/distributions/)

  - The system tests project is [here](https://bitbucket.org/activeeon/scheduling-system-tests/src/master/)

  - Example of running proactive system tests [here](http://jenkins.activeeon.com/job/scheduling-system-tests/)

* Add database intial setup;
  - Updated document provided by Gleb to configure db connection to MySQL, PG, Oracle, and SQL server [here](- Mysql connector [here](https://dev.mysql.com/downloads/connector/j/))
  - Mysql database configuration [here](https://docs.google.com/document/d/1z9qNB64Sch3n-F5dwgFCmbKzKXSqfjfjYD9PLmSsgsM/edit#heading=h.1qei06ddonzh)

  - Mysql connector [here](https://dev.mysql.com/downloads/connector/j/)

  - Postgres database configuration [here](https://docs.google.com/document/d/1z9qNB64Sch3n-F5dwgFCmbKzKXSqfjfjYD9PLmSsgsM/edit#heading=h.1qei06ddonzh)

  - Postgres connector [here](https://jdbc.postgresql.org/download.html)

* Collect performance measures : memory, cpu, security;
