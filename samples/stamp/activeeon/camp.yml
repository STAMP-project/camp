#
# CAMP
#
# Copyright (C) 2017, 2018 SINTEF Digital
# All rights reserved.
#
# This software may be modified and distributed under the terms
# of the MIT license.  See the LICENSE file for details.
#

goals:
  running:
    - Proactive

components:

  proactive:
    provides_services: [Proactive]
    requires_services: [Database]
    implementation:
      docker:
        file: proactive/Dockerfile

  database:
    provides_services: [Database]
    variables:
      version:
        type: version
        values: [ mysql, postgres ]
        realization:
          - targets: [ database/Dockerfile ]
            pattern: "FROM database"
            replacements: [ "FROM mysql", "FROM postgres" ]
          - targets: [ database/Dockerfile ]
            pattern: "COPY init_database.sh"
            # TO FIX POSTGRES IS EMPTY
            replacements: [ "COPY init_mysql.sql docker-entrypoint-initdb.d/init_database.sql", "" ]
          - targets: [ database/Dockerfile ]
            pattern: "RUN chmod 755 init_database.sh"
            # TO FIX POSTGRES IS EMPTY
            replacements: [ "RUN chmod 755 /docker-entrypoint-initdb.d/init_database.sql", "" ]
    implementation:
      docker:
        file: database/Dockerfile
