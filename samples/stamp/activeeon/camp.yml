
goals:
  running:
    - ProactivePG

components:
  proactive:
    provides_services: [ProactivePG]
    requires_services: [DatabasePG]
    variables:
      version:
        type: version
        values: [ PA-postgres]
        realization:
          - targets: [ proactive/Dockerfile ]
            pattern: "RUN ./change-proactive-db-config.sh"
            replacements: [ "RUN ./change-proactive-db-config-postgres.sh" ]
    implementation:
      docker:
        file: proactive/Dockerfile

  database:
    provides_services: [DatabasePG]
    variables:
      version:
        type: version
        values: [ BD-postgres]
        realization:
          - targets: [ database/Dockerfile ]
            pattern: "FROM database"
            replacements: [ "FROM postgres:9.6.3"]
          - targets: [ database/Dockerfile ]
            pattern: "COPY init_database.sql"
            replacements: [ "COPY init_postgres.sql docker-entrypoint-initdb.d/init_database.sql" ]
          - targets: [ database/Dockerfile ]
            pattern: "EXPOSE PORT"
            replacements: [ "EXPOSE 5432" ]
          - targets: [ docker-compose.yml ]
            pattern: "3306:3306"
            replacements: [ "5432:5432" ]  
          - targets: [ docker-compose.yml ]
            pattern: "MYSQL_ROOT_PASSWORD"
            replacements: [ "POSTGRES_PASSWORD" ]        
    
    implementation:
      docker:
        file: database/Dockerfile