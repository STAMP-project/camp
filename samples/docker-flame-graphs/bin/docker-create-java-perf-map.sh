#!/bin/bash -x                                                                                                                                                                                                                                                                                                                                                         
container=$1                                                                                                                                                                                                                                                                                                                                                               
host_pid=$2                                                                                                                                                                                                                                                                                                                                                                
container_pid=$(docker exec $container jps | grep -v Jps | cut -f 1 -d " ")                                                                                                                                                                                                                                                                                                
echo "Container PID: $container_pid"                                                                                                                                                                                                                                                                                                                                       
sudo rm -rf /tmp/perf-${host_pid}.map
docker exec $container /bin/bash -c "export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64/"
docker exec $container /bin/bash -c "echo $JAVA_HOME"
docker exec $container /docker-flame-graphs/bin/create-java-perf-map.sh $container_pid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
docker exec $container cat /tmp/perf-${container_pid}.map -- > /tmp/perf-${host_pid}.map                                                                                                                                                                                                                                                                                   
sudo chown root:root /tmp/perf-${host_pid}.map                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
